\section{The A3-E Model}\label{sec:proposal}

\begin{figure}[tbp]
	\includegraphics[width=1\textwidth]{figs/A3-E-model.pdf}
	\caption{The A3-E Model.}
	\label{fig:A3-E-model}
\end{figure}

As depicted in Fig.~\ref{fig:A3-E-model}, the \textit{A3-E model} consists of the different actors and mechanisms required for the realization of the cloud-edge-mobile continuum. Its name inherits from the four phases process -- namely, \textit{(\textbf{A}wareness), (\textbf{A})cquisition, (\textbf{A})llocation, and (\textbf{E})ngagement}. Each phase addresses specific concerns in the interaction among client applications and the constituents of the continuum. To address the continuum heterogeneity, the A3-E process is flexible with respect to which phases are employed and how they are employed.

The A3-E model is also composed of \textit{client applications}, which are responsible for triggering \textit{requests} containing \textit{requirements} for  \textit{services} provided by \textit{domains}. The latter is an abstraction of service providers in the continuum, featuring heterogeneous \textit{computational resources} (e.g., server(s), virtual machine(s), container(s), memory, CPU, storage) and networking infrastructures (e.g., access points, radio access networks). Examples of these domains are \textit{cloud-domains}, representing cloud-based FaaS platforms covering a region (e.g., Amazon Lambda in Europe), \textit{edge-domains}, representing local-edge and mobile-edge sites (e.g., servers within an office building or at cellular base stations), and \textit{mobile-domains}, representing mobile device's own resources.
%, which in this paper are not shared with other devices.
Finally, the model includes a \textit{client-side middleware} and a \textit{domain-side middleware} realizing the \textit{A3-E process}: the former is responsible for handling application requests and forwarding them to the domain best satisfying the client requirements at a given context; and the latter is responsible for the self-management of services life-cycle in a given domain. 
%TODO CSM and DSM are not well-known acronyms and introduce noise. Better to stick to Domain-side middleware and Client-side middleware [Martin]

%\subsection*{Functions-as-a-Service (FaaS)}

%TODO compare bellow
%Aligned to our previous work~\cite{GarrigaMendonca2017}, A3-E addresses the efficiency required by edge domains by adhering to the FaaS execution model in which stateless functions can be allocated on demand without minimum pre-allocation of resources. The same model is employed by cloud-domains, which enables a uniform execution model among cloud and edge. In turn, mobile domains are exempt of implementing the allocation phase, as in this work we assume local services to be allocated along with the client application. 

Aligned to our previous work~\cite{GarrigaMendonca2017}, A3-E addresses the efficiency, scalability and automation required by heterogeneous domains by adhering to a Serverless Architecture~\cite{Hendrickson:2016}): a refined cloud computing model to process requested functionality without pre-allocating any computational resource. Provider-managed shared containers are used to execute functions, which are automatically provisioned on demand in few milliseconds, elastically scaled as needed, and ephemeral (may only last for one invocation)~\cite{Roberts:2016}. This approach allows one to write and deploy code (functions) without considering the server runtime environment, resource allocation, load balancing, and scalability; all these aspects are automatically handled by the provider --- hence the term serverless.
% in which stateless functions can be allocated on demand without minimum pre-allocation of resources. 
Such an architecture is already employed by multiple cloud providers\footnote{\url{https://blog.zhaw.ch/icclab/faas-function-hosting-services-and-their-technical-characteristics}}; its adoption by edge providers would have the following benefits: 1) \textit{scalability}, with the delegation of resource management; 2) \textit{efficiency}, with the provisioning of functions on demand without pre-allocation of computational resources; and 3) \textit{portability}, as functions are stateless and may be implemented in different languages, including those supported by mobile platforms. 
The serverless architecture represents the latest step in the recent shift of enterprise application architectures to containers and microservices~\cite{baldini2017serverless}, which also allows the A3-E model to overcome the heterogeneity of the continuum by adhering to service-oriented principles. Clients engage with remote (micro)\textit{services} --- implemented through functions --- by means of a request/response protocol (e.g., RESTful services over HTTP). Needless to say, mobile devices should also expose offered functionality as local services to enforce a common interface between clients and heterogeneous domains. 

Despite the benefits of serverless, the complete self-management of services life-cycle is still missing. A3-E covers this gap with a process (depicted in Fig.~\ref{fig:A3-E-process}) whose phases may be instantiated by different domains along the continuum. For each phase, the process models the activities of both \textit{domain} and \textit{client}. Next, we describe the four phases depicted in Fig.~\ref{fig:A3-E-process}, which represents the complete instance of the A3-E process. The phases are introduced from the most general (i.e., those that apply for all domains and clients) to the most specific ones (i.e., those that apply only to particular configurations of domains and clients). Possible instances of the process are mapped to distinct scenarios of the continuum, including those in which one or more phases are not employed.

%from the moment they become aware of each other to the point they may engage in client-server interactions

\begin{figure}[tbp]
	\includegraphics[width=0.95\textwidth]{figs/A3-E-process}
	\caption{The A3-E Process. Phases are delimited by vertical lines and the main activity of each phase by the label within each phase; labels within parenthesis represent the states of a domain to a client (and vice-versa)}
	\label{fig:A3-E-process}
\end{figure}

%\subsection{A3-E Process: Phases}\label{sec:A3-E-process}

%Next, the four A3-E phases are further described and mapped to the requirements elicited in  Section~\ref{sec:requirements}. Later on, other possible instances of the A3-E model are correlated with scenarios of the compute continuum.

\subsection*{Engagement Phase}\label{sec:A3-E-engagement}
%TODO: it's strange to start by explaining (E)ngagement, since it is the last in the model [Martin]

The \textit{engagement} phase models the actual request-response interaction between a client applications and service providers in the continuum. At this stage, the application request has been handled and parsed by the client-side middleware (CSM). Also, one or more domains must have setup and allocated the requested service for execution and the CSM must have selected a specific domain among all providing the same service. Finally, client's request are sent, processed, received, and returned to the application.

%Current FaaS providers allow functions to be exposed as REST services. The same applies to open source platforms implementing the FaaS model. Finally, different approaches may be used to expose local computation as services in mobile platforms like Android and iOS.

%As an exception, computation provided by mobile devices can be accessed by means of local calls to functions executed by the mobile platform.

\subsection*{Allocation Phase}\label{sec:A3-E-allocation}

%TODO Within each figure should explicitly say where it happens: Fig. a: DOMAIN, fig. b: CLIENT [Martin]
\begin{figure}[thbp]
	\centering
	\captionsetup[subfigure]{width=0.4\textwidth}	
	\null\hfill
	\subfloat[Services allocation control loop; domains must monitor the QoS of deployed services and adapt its allocation scheme to prevent SLA violation.\label{fig:service-allocation-loop}]{ \includegraphics[width=0.4\textwidth]{figs/service-allocation-loop}}
	\captionsetup[subfigure]{width=0.4\textwidth}	
	\hfill
	\subfloat[Domain selection control loop; clients must monitor available domains and select the one that best satisfies its requirements.\label{fig:domain-selection-loop}] {\includegraphics[width=0.4\textwidth]{figs/domain-selection-loop}}
	\hfill\null
	\caption{Self-management control loops for service allocation and domain selection}\label{fig:allocation-loops}
\end{figure}

From the domain's perspective, the allocation phase models the placement of services along the domain's pool of runtime resources. In specific, it models the allocation of functions to the pool of containers managed by a domain. 
%Traditionally, cloud domains employ automated scaling mechanisms in which virtual machines and container instances are (de)allocated on demand. More recently, cloud-based FaaS platforms (e.g., Amazon Lambda, Google Cloud Functions) extend these mechanisms to stateless functions. The later represent an extreme type of allocation in which no pre-allocation of resources is needed and functions are executed by a shared runtime platform. 
This phase is realized by the domain-side middleware (DSM) with a self-management loop~\cite{kephart2003vision} (Fig.~\ref{fig:service-allocation-loop}) in which functions corresponding to provided services are instantiated according to: a) the monitored QoS (e.g., the availability of each service); b) the Service-Level Agreement (SLA); and c) the availability of computational resources. 

%For instance, in a centralized implementation, the DSM orchestrates the placement of functions to containers distributed along multiple servers.

For cloud domains, scalability is limited by the SLA only. In contrast, finely distributed edge domains feature limited scalability and must prioritize its resources to applications with more demanding requirements.
%For instance, mission critical applications should have priority over non-critical applications that may cope with lower degrees of availability. 
%TODO this should be moved to a case scenario
For instance, edge providers could support two types of SLA: one for critical applications requiring high service availability; and another for non-critical applications that may cope with lower degrees of availability. 
%The first type could be achieved with the pre-allocation of resources to these services, whilst the latter could rely on the opportunistic allocation of services upon demand and availability of resources. 
As an example, in the scenario introduced in Sec.~\ref{sec:continuum-scenario}, the AV application should have priority over non-critical applications such as an AR application for guiding tourists~\cite{GarrigaMendonca2017}. During rush hours, edge services could become unavailable for the AR application, during which they would rely on local services or cloud-based services. In all other moments, the AR would be able to rely on edge-based services. 

%The specific algorithms for the placement of services among the domain's resources that should be employed at the analysis phase are out of the scope of this paper. Nonetheless, recent works~\cite{} have addressed this challenge in the context of a continuum formed by edge and cloud datacenters. 

From the client's perspective, the allocation phase models the selection of the best domain alternative satisfying the client's requirements for a given service. 
%, i.e., it models the computation placement along the client's perception of the continuum. 
%This decision should consider a list of available domains providing services requested by the client application with accompanying QoS attributes. Accordingly, whereas the domains should take care of intra-domain allocation through service placement, the clients are responsible for the inter-domain allocation through service selection.
Analogously to the domain-side, the CSM manages allocation with a self-management loop (Fig.~\ref{fig:domain-selection-loop}) by checking QoS levels of services from each available domain and deciding for the alternative that best satisfies the client's requirements. 
%This sub-process is the main client-side activity required for the realization of the continuum, as it allows clients to seamlessly alternate among different continuum domains according to the context. 
For example, upon unavailability of edge domains providing services with low latency, the AR application previously introduced would have to choose among mobile or cloud domain. If the application requirements prioritizes low battery consumption (e.g., because battery level is low), it should opt for the cloud domain. Otherwise, if low latency is the priority requirement, it should opt for the cloud domain. As the number of requirements grow, a multi-objective optimization algorithm~\cite{Olson1996} may be employed to decide among alternative domains.



%The allocation phase has the following purposes: 1) to enable the efficient (Req. \textbf{R1.1}) and automated (Req. \textbf{R3.1}) allocation of domains' computational resources; and to enable clients to choose the best candidate among different available domains (Req. \textbf{R2.1}).



\subsection*{Acquisition Phase}\label{sec:A3-E-acquisition}

%The Acquisition phase has the following purposes: 1) to enable the efficient (Req. \textbf{R1.2}) and automated (Req. \textbf{R3.2}) download and installation of service artifacts; and 2) to enable clients to identify, among the known domains, those compatible with their requirements (Req. \textbf{R2.1}).

From the domain's perspective, the allocation phase models the dynamic and automated acquisition of service artifacts upon identification of requirements from a given application. Its ultimate goal is to mitigate the usage of domain resources before actual service demand and, more importantly, encapsulate this operational aspect from developers and administrators. The later are relevant for the realization of finely distributed edge domains, 
%specially those integrated to local network infrastructures (e.g., local-edge domains integrated to domestic and office infrastructures), 
as manual and external administration of a large scale of services may be cumbersome and expensive. In addition, cloud-based providers may also benefit from the automated acquisition of services artifacts. To the best of our knowledge,
%the automated acquisition in today's IaaS providers is limited to the replication of virtual machines and containers in which services are already deployed as full applications~\cite{Quatrocchi2016discrete}. More recently, 
cloud-based FaaS platforms support the uploading of functions through a public interface. that can be employed by automated processes triggered and executed outside the domain. Following the A3-E approach, the acquisition of functions would be managed by a process within the cloud domain, allowing services to be downloaded and installed on demand. In contrast, mobile domains are exempt of performing the allocation phase as local service artifacts are assumed to be downloaded and installed along with the client application.

% In addition to function sources, artifacts may comprise data and libraries needed by the service.

The acquisition phase is realized by the DSM with the following sub-process: first, receiving from the CSM the set of application requirements, namely the services to be installed along with a repository URL from which their artifacts can be downloaded. Then, fetching all artifacts and installing all dependencies. Finally, whenever service acquisition finishes, the DSM informs their clients about its (un)availability according to the acquisition result. Throughout the services life-cycle, the DSM also checks for new versions of acquired services from the same repositories and updates them accordingly. As an example, the services consumed by both AR applications introduced early can be autonomously acquired on demand by the local-edge servers in the user's office and home, preventing the company and the user to perform such operation. 

%In case the service has already been acquired or as the acquisition finishes, clients should add that domain to their list of available domains. 

From the client's perspective, acquisition models the simple addition of a domain to a list of available domains, which should follow the identification of the domain's capability in providing the requested service. This phase is realized by the CSM with the following sub-process: the CSM should expect a confirmation from the DSM regarding its compliance in providing the service required by the application. Once confirmed, the CSM adds that domain to a list of available domains used by the client-side allocation phase. 

%As an example, a real-time translation application from/to streams of different spoken languages require services with low-latency. The translation can either rely on local services provided by the mobile domain (zero network latency) or on remote services provided by the edge domain (low network latency). Given the battery constraints of the mobile device, edge services are preferred. Instead of having all artifacts pre-installed, the edge's DSM acquires the data and codebase from a repository informed by the CSM upon detection of the user in its coverage area. The setup process takes no more than a minute, during which local services were consumed. Once the setup is ready, the application can start streaming captured conversations to edge-based services, which in turn reply with a translated audio stream.

%From the domain-side, the lack of acquisition implies that service assets must be previously made available. Nonetheless, the preliminary acquisition of a large number of assets is limited by the domain storage capability. 

%Conversely, the automated and opportunistic acquisition of service assets improves storage efficiency with the cost of a setup time $\Delta_{AQ}$. For instance, domains that become aware of clients' requirements may pro-actively start the acquisition phase and become ready for allocation before the first service request arrives.

%otherwise, domains must rely on the detection of a first service request or some other triggering condition to start the acquisition phase and, after setup time $\Delta_A$, become ready for allocation. 


\subsection*{Awareness Phase}\label{sec:A3-E-awareness}



%Why do we need awareness?
%CA: awareness is not needed because the edge domain should always be coupled to the network infrastructure; network components shoudl aways route traffic to existing edge servers; additionally, the edge domain should be able to acquire and allocate services upon detection of the first requests.  
%A: A3-E model is agnostic w.r.t. the use of network technologies to route traffic to the edge servers; a given domain may count on network components to traffic route to its servers instead of negociating directly with clients aware of its existance; nonetheless, the lack of awareness limits the acquisition and deployment of services to reactive, as the domain would only identify a given service upon the first request has been made. Without awareness, clients would not be able to choose from alternative domains. 

Last but not least, from the domain's side, the awareness phase models the discovery by a domain of client applications in the domain's coverage area. Its main purpose is to enable domains to pro-actively initialize the acquisition and allocation phases based on the physical awareness of hosting devices in the domain's coverage are. Cloud-based FaaS platforms like Amazon Lambda adopt a cold start policy in which functions are allocated after their first call following a period of idleness. Taking advantage of edge's locality, the proposed awareness has two benefits: 1) it alleviates the cold start issue by pro-actively allocating functions just before they are needed; and 2) it enables service acquisition to be opportunistic.

%It copes with the need for efficiency and scalability of finely distributed edge domains by allowing acquisition and/or allocation of services to happen just in time, i.e., just before the client application needs them.
%and enables not only functions to be allocated, but also acquired in an opportunistic fashion.
%The benefit lies in the anticipation of (opportunistic) services setup with respect to the arrival of the first service request, i.e., in the mitigation of service setup delay (also known as cold start). Since cloud domains cover a large area, the later do not employ the awareness phase. Needless to say, mobile domains do not require awareness for sharing the same platform with client applications.

The DSM realizes this phase with the broadcast of its existence (advertisement) and the discovery of client applications along with their requirements (i.e., services). The later are passed to the following phase of acquisition.
%then receive all client application requirements (i.e., services) as soon as the client's mobile device enters the domain's coverage area, and then pro-actively starting acquisition and allocation. 
%For example, in the real-time translation application previously introduced, the service setup delay was mitigated by having the acquisition of the data and codebase composing the service to start as soon as the user entered the edge domain's coverage area.
For example, the setup of services required by the mobile multiplayer game application by the user's local-edge server follows the awareness of a new application.

From the client's perspective, the awareness phase models the discovery of domains and corresponding services whose network address is not previously known. In specific, it targets edge domains that are integrated with the local network infrastructure of buildings and public spaces. This modality contrasts with cloud and possibly mobile-edge domains~\cite{ahmed2016isco} featuring a well-known Internet name that is solved by networking components such as traffic managers and DNS technology. Needless to say, the awareness phase is not considered by mobile domains.

The CSM realizes this phase by intercepting the broadcast advertisement messages on a reactive way, to then send its application requirements to the newly available domain.
This process should happen once and in a timely fashion upon connection to new networks to mitigate battery consumption overhead. As an example, the same local-edge server in our user's home is discovered whenever his device(s) connect to his private network. Once the domain is ready, this domain becomes an alternative for the provisioning of services required by the many applications (e.g., the mobile multiplayer game) hosted by the user's smartphone, tablet, and/or other of his IoT gadgets. 


%Finally, the Awareness phase has the following purposes: 1) to enable domains to pro-actively initialize the acquisition and allocation phases based on its awareness of applications whose hosting devices happens to be in the domain coverage area (Req.~\textbf{R2.3}); and 2) to enable clients to discover the address of local domains (Req.~\textbf{R2.2}).

%From the domains perspective, the awareness of clients presence in their coverage area allows a proactive download and installation of services artifacts (acquisition phase) and/or the allocation of services (allocation phase) potentially before a first request to that service arrives, alleviating the delay introduced by services setup.  From the clients perspective, the awareness phase increases the range of alternatives from the continuum that can be used to satisfy their requirements.

%Such behavior allows that are opportunistically acquired and/or allocated to mitigate their setup delay by triggering these phases upon awareness of client(s) in their coverage area.

%From the domain-side, the lack of awareness of clients in the domain coverage area prevents triggering the acquisition and subsequently allocation phases based on this event. From the client-side, the lack of awareness from surrounding domains prevents them to make the decision of which domains to use. In the later case, clients must rely on external components to reach servers (e.g., traffic managers and DNS servers).

%\input{sections/policies}


%
%\subsection{Reference Architecture}
%
%\begin{figure}[tbp]
%	\includegraphics[width=.95\textwidth]{figs/A3-E-reference-architecture}
%	\caption{A3-E architecture in Mobile Devices and Edge Domains}
%	\label{fig:reference-architecture}
%	\end{figure}
	
